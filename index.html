<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claire & Nadine Strip</title>
    <style>
        :root { --cream: #f4ecd8; --sepia: #704214; }
        body { 
            background: #d7ccc8; font-family: 'Courier New', monospace; 
            display: flex; flex-direction: column; align-items: center; padding: 20px;
        }
        #camera-container {
            position: relative; width: 320px; height: 240px;
            border: 8px solid white; box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            background: #000; overflow: hidden;
        }
        video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        
        /* Layout for the 4-shot preview */
        #strip-preview {
            margin-top: 20px; display: grid; grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr; gap: 5px; background: white;
            padding: 10px; width: 200px; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .preview-box { width: 90px; height: 70px; background: #eee; object-fit: cover; }
        
        #countdown {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 5rem; color: white; font-weight: bold; z-index: 10; display: none;
        }
        .main-btn {
            margin-top: 20px; padding: 15px 40px; background: #a64452;
            color: white; border: none; cursor: pointer; font-size: 1.2rem;
        }
        #status { margin-top: 10px; font-weight: bold; color: var(--sepia); }
    </style>
</head>
<body>

    <h1>Photo Strip Booth</h1>
    
    <div id="camera-container">
        <video id="video" autoplay playsinline></video>
        <div id="countdown">3</div>
    </div>

    <div id="status">Ready for 4 poses?</div>
    <button class="main-btn" onclick="startSequence()">Start 4-Shot Session</button>

    <div id="strip-preview">
        <img class="preview-box" id="pre0">
        <img class="preview-box" id="pre1">
        <img class="preview-box" id="pre2">
        <img class="preview-box" id="pre3">
    </div>

    <canvas id="stripCanvas" style="display:none;" width="800" height="1200"></canvas>

    <script>
        const video = document.getElementById('video');
        const countdownEl = document.getElementById('countdown');
        const statusEl = document.getElementById('status');
        let shots = [];
        let isCapturing = false;

        // Load your sticker PNGs
        const stickers = [new Image(), new Image(), new Image(), new Image()];
        stickers[0].src = 'IMG_2542.png';
        stickers[1].src = 'IMG_2544.png';
        stickers[2].src = 'IMG_2543.png';
        stickers[3].src = 'IMG_2546.png';

        navigator.mediaDevices.getUserMedia({ video: true }).then(s => video.srcObject = s);

        async function startSequence() {
            if(isCapturing) return;
            isCapturing = true;
            shots = [];
            
            for(let i=0; i<4; i++) {
                statusEl.innerText = `Get ready for Pose ${i+1}/4...`;
                await runCountdown();
                captureShot(i);
                await sleep(1000); // Small breath between shots
            }
            
            statusEl.innerText = "Processing your strip...";
            generateStrip();
            isCapturing = false;
            statusEl.innerText = "Downloaded! Ready for another?";
        }

        function runCountdown() {
            return new Promise(resolve => {
                let count = 3;
                countdownEl.style.display = 'block';
                countdownEl.innerText = count;
                let timer = setInterval(() => {
                    count--;
                    if(count > 0) countdownEl.innerText = count;
                    else {
                        clearInterval(timer);
                        countdownEl.style.display = 'none';
                        resolve();
                    }
                }, 1000);
            });
        }

        function captureShot(index) {
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = 400; tempCanvas.height = 300;
            const ctx = tempCanvas.getContext('2d');
            ctx.translate(400, 0); ctx.scale(-1, 1); // Mirror
            ctx.drawImage(video, 0, 0, 400, 300);
            
            const data = tempCanvas.toDataURL('image/png');
            shots.push(data);
            document.getElementById(`pre${index}`).src = data;
        }

        

        function generateStrip() {
            const canvas = document.getElementById('stripCanvas');
            const ctx = canvas.getContext('2d');
            
            // 1. Background
            ctx.fillStyle = "white";
            ctx.fillRect(0, 0, 800, 1200);

            // 2. Draw the 4 photos in 2x2 grid
            const positions = [
                {x: 40, y: 40}, {x: 410, y: 40},
                {x: 40, y: 360}, {x: 410, y: 360}
            ];

            shots.forEach((shotData, i) => {
                const img = new Image();
                img.src = shotData;
                img.onload = () => {
                    ctx.drawImage(img, positions[i].x, positions[i].y, 350, 280);
                    
                    // 3. Draw Sticker per box (with white outline effect)
                    const sticker = stickers[i];
                    ctx.save();
                    // Positioning sticker at bottom-right of each box
                    const sx = positions[i].x + 220;
                    const sy = positions[i].y + 150;
                    
                    // Simple white outline for sticker
                    ctx.shadowColor = "white"; ctx.shadowBlur = 10;
                    ctx.drawImage(sticker, sx, sy, 120, 120);
                    ctx.restore();

                    if(i === 3) finishStrip(canvas);
                };
            });
        }

        function finishStrip(canvas) {
            const ctx = canvas.getContext('2d');
            // 4. Footer Text
            ctx.fillStyle = "#3e2723";
            ctx.font = "bold 45px 'Courier New'";
            ctx.textAlign = "center";
            ctx.fillText("CLAIRE & NADINE", 400, 1100);
            ctx.font = "30px 'Courier New'";
            ctx.fillText("2026 PHOTOBANK", 400, 1150);

            const finalUrl = canvas.toDataURL('image/png');
            const link = document.createElement('a');
            link.download = `photostrip-${Date.now()}.png`;
            link.href = finalUrl;
            link.click();
        }

        function sleep(ms) { return new Promise(res => setTimeout(res, ms)); }
    </script>
</body>
</html>
